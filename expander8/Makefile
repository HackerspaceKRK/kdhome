# Generated by KD build system

CC=arm-none-eabi-gcc-col
CXX=arm-none-eabi-g++-col
OUTPUT=main.elf

F_CPU=8000000
RAMSIZE=20480

DEFINES=-DVERSION=2 -DESP -DSTM32F10X_MD -DPRINTF -DF_CPU=$(F_CPU) -DRAMSIZE=$(RAMSIZE)
INCLUDEPATH=-Iesp -I. -I.. -I../providers -Ikdusb -Istm32-public -I../kdutils/uclibs -I../kdutils
LIBS=-lm -lc

CFLAGS=-mcpu=cortex-m3 -march=armv7-m -mfix-cortex-m3-ldrd -msoft-float -mthumb -nostartfiles -ggdb -Werror=implicit -Os -fdata-sections -ffunction-sections
CFLAGS+=$(DEFINES)
CFLAGS+=$(INCLUDEPATH)
LFLAGS=-Wl,--relax,--gc-sections -Wl,-gc-sections -Wl,-Map=build/$(OUTPUT).map -Wl,-T main.ld
LFLAGS+=$(LIBS)

all: prepare build/$(OUTPUT)
	arm-none-eabi-objcopy -O binary build/$(OUTPUT) build/$(OUTPUT).bin
	arm-none-eabi-objcopy -O ihex build/$(OUTPUT) build/$(OUTPUT).hex
	arm-none-eabi-objdump -h -S build/$(OUTPUT) > build/$(OUTPUT).lst
	arm-none-eabi-size build/$(OUTPUT)

prepare:
	mkdir -p build/

build/main.o: main.c
	$(CC) $(CFLAGS) -c $< -o $@

build/isr.o: isr.c
	$(CC) $(CFLAGS) -c $< -o $@

build/utils.o: utils.c
	$(CC) $(CFLAGS) -c $< -o $@

build/temp.o: temp.c
	$(CC) $(CFLAGS) -c $< -o $@

build/io.o: io.c
	$(CC) $(CFLAGS) -c $< -o $@

build/ir.o: ir.c
	$(CC) $(CFLAGS) -c $< -o $@

build/stm32-public_delay.o: stm32-public/delay.c
	$(CC) $(CFLAGS) -c $< -o $@

build/stm32-public_myprintf.o: stm32-public/myprintf.c
	$(CC) $(CFLAGS) -c $< -o $@

build/stm32-public_ow.o: stm32-public/ow.c
	$(CC) $(CFLAGS) -c $< -o $@

build/__kdutils_uclibs_advinputmanager.o: ../kdutils/uclibs/advinputmanager.c
	$(CC) $(CFLAGS) -c $< -o $@

build/esp_esp.o: esp/esp.c
	$(CC) $(CFLAGS) -c $< -o $@

build/__3rd_IRremote.o: ../3rd/IRremote.c
	$(CC) $(CFLAGS) -c $< -o $@

build/__providers_providers.o: ../providers/providers.c
	$(CC) $(CFLAGS) -c $< -o $@

build/__providers_provider_output.o: ../providers/provider_output.c
	$(CC) $(CFLAGS) -c $< -o $@

build/__providers_provider_input.o: ../providers/provider_input.c
	$(CC) $(CFLAGS) -c $< -o $@

build/__providers_provider_temp.o: ../providers/provider_temp.c
	$(CC) $(CFLAGS) -c $< -o $@

build/__providers_provider_ir.o: ../providers/provider_ir.c
	$(CC) $(CFLAGS) -c $< -o $@

build/$(OUTPUT): build/main.o build/isr.o build/utils.o build/temp.o build/io.o build/ir.o build/stm32-public_delay.o build/stm32-public_myprintf.o build/stm32-public_ow.o build/__kdutils_uclibs_advinputmanager.o build/esp_esp.o build/__3rd_IRremote.o build/__providers_providers.o build/__providers_provider_output.o build/__providers_provider_input.o build/__providers_provider_temp.o build/__providers_provider_ir.o
	$(CC) $(CFLAGS) $(LFLAGS) $^ -o $@

